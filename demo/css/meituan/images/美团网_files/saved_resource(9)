M.add("w-slider",function(a){var b=a.Lang.isFunction,c=a.UA,d=a.mt.util,e="mt-slider",f={triggerContainer:e+"-trigger-container",triggerContainerEx:e+"-trigger-container-ex",trigger:e+"-trigger",currentTrigger:e+"-current-trigger",sheetContainer:e+"-sheet-container",sheet:e+"-sheet",currentSheet:e+"-current-sheet",previous:e+"-previous",next:e+"-next"},g=a.config["w-slider"]||{},h=function(){h.superclass.constructor.apply(this,arguments)};h.NAME="Slider",h.CSS_PREFIX=e,h.HTML_PARSER={sheetContainer:"> ."+f.sheetContainer,triggerContainer:"> ."+f.triggerContainer,triggerContainerEx:"> ."+f.triggerContainerEx,previous:"> .previous",next:"> .next"},h.TEMPLATE={trigger:'<a href="javascript:;" hidefocus="true" class="{previous}"></a><a href="javascript:;" hidefocus="true" class="{next}"></a>',statusBar:"<ul></ul>"},h.CLASS_NAME=f,h.ATTRS={sheetContainer:{value:null,setter:function(b){return a.one(b)}},triggerContainerEx:{value:null,setter:function(b){return a.one(b)}},triggerContainer:{value:null,setter:function(b){return a.one(b)}},pnContainer:{value:null,setter:function(b){return a.one(b)}},previous:{value:null,setter:function(b){return a.one(b)}},next:{value:null,setter:function(b){return a.one(b)}},autoPlay:{value:!0},activeStop:{value:!0},pnAutoHide:{value:!1},interval:{value:5e3},effect:{value:"slideLeft"},duration:{value:300},triggerEvent:{value:"click"},index:{value:0},hoverOpacity:{value:c.ie<=8&&c.ie>0?1:.6},lazyloading:{value:!1}},a.extend(h,a.Widget,{initializer:function(){var a=this,b=a.get("sheetContainer"),c=b&&b.all("> li");if(c&&c.isEmpty())throw new Error(h.NAME+": 没有内容页");a._timer=null,a._handles={},a._pause=!1,a._nlSheet=c},destructor:function(){d.detachHandle(this._handles),this.get("boundingBox").remove(!0)},_beforeRenderUI:function(){var a=this.get("index"),b=this._nlSheet,c=b.item(a);this._updateImgs(c),c.show(),"slideFadeIn"===this.get("effect")&&(b.setStyle("opacity",0),c.setStyle("opacity",1))},_afterRenderUI:function(){var a=this._nlSheet,b=(this.get("index")+1)%a.size();this._updateImgs(a.item(b))},_updateImgs:function(a){var b="data-src";this.get("lazyloading")&&a.all("img[data-src]").each(function(a){g.cssLazyClass&&a.on("load",function(){a.removeClass(g.cssLazyClass)}),a.set("src",a.getAttribute(b)),a.removeAttribute(b)})},renderUI:function(){this._beforeRenderUI(),this._renderTriggerContainer(),this._modifySheetContainer(),this._renderPreNextContainer(),this._anim=this._getAnim(),this._afterRenderUI()},_renderTriggerContainer:function(){function a(){for(var a="<li></li>",b=[],c=0;c<d.size();c++)b.push(a);return b.join("")}var b=this.get("triggerContainer"),c=this.get("triggerContainerEx"),d=this._nlSheet,e=this.get("index"),g=0,h=null;b?(g=b.all("> li").size(),d.size()!==g&&b.setHTML(a()),"none"===b.getStyle("display")&&b.show(),h=b.all("> li"),h.addClass(f.trigger),h.item(e).addClass(f.currentTrigger),b.addClass(f.triggerContainer)):c&&(c.one(".total").setHTML(d.size()),c.one(".current").setHTML(1),"none"===c.getStyle("display")&&c.show())},_modifySheetContainer:function(){var a=this.get("sheetContainer"),b=this._nlSheet,c=this.get("index");a.addClass(f.sheetContainer),b.addClass(f.sheet),b.item(c).addClass(f.currentSheet),b.each(function(a,b){b!==c&&a.hide()})},_renderPreNextContainer:function(){var a=this.get("previous"),b=this.get("pnAutoHide"),c=this.get("next");c||a?b&&(a&&(a.setStyle("opacity",0),a.show()),c&&(c.setStyle("opacity",0),c.show())):this.buildPreNext()},buildPreNext:function(){var b,c,d,e=this.get("pnContainer"),g=this.get("pnAutoHide");e&&(d=a.Node.create(a.Lang.sub(h.TEMPLATE.trigger,f)),e.append(d),this.set("previous",b=e.one("."+f.previous)),this.set("next",c=e.one("."+f.next)),g&&(b.setStyle("opacity",0),c.setStyle("opacity",0)))},bindUI:function(){var a=this,b=a.get("triggerContainer"),c=a.get("sheetContainer"),d=this.get("pnAutoHide"),e=b&&b.all("> li");a.isFromNavigator=!1,a.after("indexChange",this._defIndexChangeFn,this),c.on({mouseover:function(){a.pause()},mouseout:function(){a.reset()}}),e&&e.each(function(b,c){b.on(a.get("triggerEvent"),function(b){b.halt(),a.set("index",c),a._activeStop=!0,a.reset()})}),this.lrBtnClickHandler(),d&&this.handleLrBtnHide()},syncUI:function(){this.get("autoPlay")&&this.play()},lrBtnClickHandler:function(){var a=this.get("previous"),b=this.get("next"),c=this;a&&a.on("click",function(a){a.halt(),c.showPrevious(),c._activeStop=!0,c.reset()}),b&&b.on("click",function(a){a.halt(),c.showNext(),c._activeStop=!0,c.reset()})},handleLrBtnHide:function(){function a(){f.setStyle("opacity",i),g.setStyle("opacity",i)}function b(a){a.pageX>d.left&&a.pageX<d.left+d.width&&a.pageY>d.top&&a.pageY<d.top+d.height||(f.setStyle("opacity",0),g.setStyle("opacity",0))}var c,d,e,f=this.get("previous"),g=this.get("next"),h=this,i=this.get("hoverOpacity");g&&f&&(e={mouseover:a,mouseout:b},c=h.get("sheetContainer"),d=c.get("region"),c.delegate(e,".mt-slider-sheet"),g.on(e),f.on(e))},_defIndexChangeFn:function(a){var b=this,c=b.get("triggerContainer"),d=b.get("triggerContainerEx"),e=c&&c.all("> li"),g=b._nlSheet,h=g.size(),i=a.prevVal,j=a.newVal;e&&a.newVal>=e.size()||(b._updateImgs(g.item(a.newVal)),e&&(e.item(i).removeClass(f.currentTrigger),e.item(j).addClass(f.currentTrigger)),d&&d.one(".current").setHTML(j+1),b.isFromNavigator||(b._dir=2===h?!0:Math.abs(j-i)===h-1?i>j:j>i),b._anim(g.item(i),g.item(j)))},_getAnim:function(){var c,d,e,f,g,i,j,k,l=this,m=l.get("sheetContainer"),n=l.get("effect"),o=l.get("duration")/1e3,p=null,q=null,r=null,s=!0;switch(n){case"slideHorizontal":case"slideLeft":c=parseInt(m.getStyle("width"),10),d={left:c},i={left:-c},k={left:0},q={nextStyles:{left:c},currentAnimTo:{left:-c}},r={nextStyles:{left:-c},currentAnimTo:{left:c}};break;case"slideVertical":case"slideUp":c=parseInt(m.getStyle("height"),10),d={top:c},i={top:-c},k={top:0},q={nextStyles:{top:c},currentAnimTo:{top:-c}},r={nextStyles:{top:-c},currentAnimTo:{top:c}};break;case"slideFadeIn":i={opacity:0},k={opacity:1};break;default:throw new Error(h.NAME+": 切换效果类型不存在")}return e=new a.Anim({from:g||{},to:i||{},duration:o,easing:a.Easing.easeBoth}),f=new a.Anim({from:j||{},to:k||{},duration:o,easing:a.Easing.easeBoth}),p=r||null,function(a,c,g){p&&l._dir!==s&&(s=l._dir,d=p.nextStyles,e.set("to",p.currentAnimTo),p=p===q?r:q),l.isFromNavigator=!1,e.stop(!0),f.stop(!0),d&&c.setStyles(d),c.show(),e.set("node",a),e.detach("end"),e.on("end",function(){a.hide()}),f.set("node",c),f.detach("end"),f.on("end",function(){b(g)&&g(),l.fire("endAnim",{index:l.get("index")})}),e.run(),f.run()}},showPrevious:function(){var a=this,b=a.get("index"),c=a._nlSheet.size(),d=0===b?c-1:(b-1)%c;a.isFromNavigator=!0,a._dir=!1,a.set("index",d)},showNext:function(){var a=this,b=a.get("index"),c=a._nlSheet.size(),d=(b+2)%c,e=(b+1)%c;a.isFromNavigator=!0,a._dir=!0,a.set("index",e),a._updateImgs(this._nlSheet.item(d))},pause:function(){this._pause=!0},reset:function(){var a=this;if(a._pause=!1,a.get("autoPlay")){if(window.clearTimeout(a._timer),a.get("activeStop")&&a._activeStop)return;a.play()}},isPause:function(){return this._pause},play:function(){var a=this;a._timer=window.setTimeout(function(){a.isPause()||(a.showNext(),a.play())},a.get("interval"))}}),a.mt.widget.Slider=h},"1.0.0",{requires:["mt-base","anim","widget","node"],skinnable:!0});