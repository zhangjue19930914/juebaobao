M.add("www-tips",function(a){var b=a.Node,c=a.UA.ie,d=a.mt.util,e=d.Cookie;a.mt.www.SysMsg={show:function(c,d){var e,f,g,h,i=a.all(".sysmsgw");i.size()?e=i.item(0):(e=b.create('<div class="sysmsgw common-tip"><div class="sysmsg"><span class="J-msg-content"></span><span class="close common-close">关闭</span></div></div>'),h=a.one("#hdw")||a.one("#site-mast"),h.insert(e,"after")),f=e.one(".J-tip-status"),f&&f.remove(!0),f=b.create('<span class="J-tip-status tip-status"></span>'),f.addClass("tip-status--"+c),g=e.one(".J-msg-content, p"),g.setHTML(d),e.set("id","sysmsg-"+c),g.prepend(f),this.initEvent()},remove:function(b){var c=a.all(".sysmsgw");c.size()&&(b?c.remove(!0):c.item(0).remove(!0))},initEvent:function(){var b=a.one("#sysmsg-error, #sysmsg-success");b&&b.delegate("click",function(){b.remove(!0)},".close")},init:function(b,f){if(b){var g,h="systip";g=b._node?b:a.Node.create(b),f=f&&a.one(f)||a.one("body"),f.prepend(g),a.Global.fire("PageHeight:change"),c&&8>c&&d.reflow(),g.delegate("click",function(){var a=d.decodeAttr(g,"params");if(a&&a.cookieClose){var b=e.getExpiresDate(15,0,0);e.set(h,!0,b,"/","."+M.DOMAIN_HOST)}g.remove(!0),6===c&&d.reflow()},".close")}}},a.mt.www.CommonTips={_isFirstMsg:!0,init:function(b,e,f){function g(b,c){var f;e=d.getEvalRes(c),0!==e.status&&e.msg?(f="<p>"+e.msg+"</p>",j.setAttribute("gaevent",e.gaevent)):l=!0,l?h.effect.fadeOut(!1,200,function(){a.Global.fire("PageHeight:change")}):h.effect.fadeOutSimple(!1,200,function(){m.show(h,f)})}if(b){var h;h=b._node?b:a.Node.create(b),f=f&&a.one(f)||a.one("body"),f.prepend(h),h.show(),a.Global.fire("PageHeight:change"),c&&8>c&&d.reflow();var i,j=h.one(".close"),k=d.decodeAttr(h,"commontips"),l=!1,m=this;h.plug(a.mt.plugin.Effect),h.delegate("click",function(){if(!(i&&i.isInProgress()||l)){var b={};e&&(e.type&&(b.type=e.type),e.msgid&&(b.msgid=e.msgid)),i=a.io("/index/commontips",{method:"POST",data:a.merge(k,b),on:{success:g}})}},".close")}},show:function(a,b){var e=a.one(".content");e.setHTML(b),a.effect.fadeInSimple("middle",function(){c&&8>c&&d.reflow()}),this.trackViewEvent(a)},trackViewEvent:function(a){var b="ga-params",c=a.all("[data-"+b+"]");c.each(function(a){var c=d.data(a,b).split("|");_gaq.push(["_trackEvent"].concat(c))})}},a.mt.www.VipBubble={success:function(b,c,d){var e=d.node,f=e.ancestor().insertBefore(c.markup,e);a.mt.www.VipBubble.bindBubbleEvents(f,c.cn)},bindBubbleEvents:function(a,b){a.show(),a.delegate("click",function(){a.hide(),e.set(b,!0,e.getExpiresDate(20,0,0),"/","."+M.DOMAIN_HOST)},".close")}},a.mt.www.MsgCenter={success:function(b,c,d){function e(){for(var a=["/deal/buy/","/order/check/","/order/return/"],b=document.location.pathname,c=0;c<a.length;c++)if(0===b.indexOf(a[c]))return!1;return!0}var f=d.node,g=a.one("#J-my-msg"),h=c.total;c.msglist&&(f.show(),f.appendChild(c.msglist),g.on("hover",function(){a.mt.www.MsgCenter.initScroll(a.one("#J-header-msg-list"))}),h>0&&e()&&g.one(".J-title").insert('<span class="J-msg-count msg-count">'+h+"</span>","after"))},bindMsgEvent:function(b,c,d,e){function f(b,c,d){c&&a.io(b,{method:"POST",data:{msgid:c.getData("mid")},on:{success:d}})}function g(b){var c=0,d=a.one("#J-my-msg .J-msg-count");b.hasClass("isread")||d&&(c=parseInt(d.get("innerHTML"),10),c--,c>0?d.setHTML(c):d.ancestor().remove(!0))}b=a.one(b),e=e||"nav",b&&(b.delegate("click",function(a){var b,d,h=a.target.hasClass("J-close");h||(b="a"===this.get("tagName").toLowerCase()?this.ancestor("li"):this,a.halt(),f("/message/read",b,function(){g(b),b.addClass("isread"),c&&c()}),d=this.getAttribute("href"),window._gaq.push(["_trackEvent","InnerLink","Click",e+"/drop/msgread/"+b.getData("mid")]),d?window.open(d,"_blank"):"J-header-msg-list"===b.ancestor("ul").get("id")&&window.open("/message/","_blank"))},"a, li"),b.delegate("click",function(){var a=this.ancestor("li");a.hide(200,null,function(){b.all("[data-mid]").some(function(a){return"none"!==a.getStyle("display")})||b.replace('<p class="no-msg">暂无新消息</p>'),f("/message/delete",a,function(){g(a)}),d&&d(),window._gaq.push(["_trackEvent","InnerLink","Click",e+"/drop/msgdel/"+a.getData("mid")])})},".J-close"),b.delegate("hover",function(){this.addClass("current")},function(){this.removeClass("current")},"li"))},initScroll:function(b){function c(){g=b.get("scrollHeight"),h=parseInt(b.get("clientHeight"),10),i=h-2*r,o=b.get("scrollTop"),j=i/g,n.setStyles(h>=g?{height:"0px",top:r+"px",right:"2px"}:{height:j*h+"px",top:o*j+r+"px",right:"2px"})}function d(){b.on("hover",function(){l=f()},function(){l&&l.detach()})}function e(){return window.setTimeout(function(){n.setStyle("opacity","0")},q)}function f(){return b.on({mousewheel:function(a){a.halt(!0),k&&(window.clearTimeout(k),k=null),n.setStyle("opacity","0.5"),k=e(),(a.wheelDelta*s<=0||o>=0&&g-h>=o)&&(a.wheelDelta>0?(o-=p,s=1):(o+=p,s=-1)),0>o?o=0:o>=g-h&&(o=g-h),n.setStyle("opacity",.5),n.setStyle("top",o*j+r),b.set("scrollTop",o)}})}if(b){var g,h,i,j,k,l,m='<div class="scroll-bar"></div>',n=a.Node.create(m),o=0,p=20,q=2e3,r=10,s=0;if(window._gaq.push(["_trackEvent","InnerLink","Click","nav/drop/mymsg"]),b.next(".scroll-bar"))return n=b.next(".scroll-bar"),n.setStyle("opacity","0.5"),void e();b.ancestor().appendChild(n),this.bindMsgEvent(b,null,function(){c()}),window.setTimeout(function(){c(),k=e(),d()},200)}}},a.mt.www.Tips={success:function(b,c,d){var e=d.node,f=e.getData("parent");c.sysmsg?a.mt.www.SysMsg.init(c.sysmsg,f):c.commontips&&a.mt.www.CommonTips.init(c.commontips.html,c.commontips.info,f)}}},"1.0.0",{requires:["transition","www-base"]});